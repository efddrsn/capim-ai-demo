# SYSTEM-FLOWS.MD

## Fluxos do Sistema - Demo Capim AI

### √öltima Atualiza√ß√£o: 16/01/2025

---

## üìã Resumo das Altera√ß√µes Recentes

### ‚úÖ Implementa√ß√£o de Overlay Bubble para Chat

**Data:** 16/01/2025  
**Objetivo:** Melhorar a UX do chat removendo a expans√£o que empurrava o conte√∫do para baixo, substituindo por um overlay bubble flutuante.

#### üéØ Funcionalidades Implementadas:

1. **Novo Comportamento do Chat**
   - Arquivo: `src/components/ChatOverlay.tsx`
   - Pills de sugest√£o desaparecem quando usu√°rio envia mensagem
   - Overlay bubble flutuante aparece ao inv√©s de expandir a caixa
   - Backdrop semi-transparente com click-to-close
   - Barra de chat principal permanece fixa e n√£o empurra conte√∫do

2. **Design do Overlay com Backdrop**
   - Posicionamento: `fixed` centralizado horizontalmente na tela
   - Container: `w-[600px]` (600px) com altura m√°xima de 75vh
   - Backdrop escuro com blur (`bg-black bg-opacity-20 backdrop-blur-sm`)
   - Mensagens mais largas: `max-w-[480px]` para melhor legibilidade
   - Elementos semi-transparentes com blur (`bg-white/90 backdrop-blur-sm`)
   - Caixa de entrada reduzida para tamanho m√©dio (`w-96`)

3. **Intera√ß√µes Melhoradas:**
   - **Fechar conversa:** Click no backdrop, bot√£o X flutuante ou bot√£o "Limpar"
   - **Voltar √†s sugest√µes:** Automaticamente ao fechar conversa
   - **Backdrop inteligente:** Escurece e desfoca o fundo para foco na conversa
   - **Mensagens expandidas:** Largura maior (480px) para melhor leitura
   - **Input otimizado:** Caixa de entrada em tamanho m√©dio, n√£o ocupa toda largura
   - **Efeitos visuais:** Semi-transpar√™ncia e blur em todos os elementos

### ‚úÖ Novo M√≥dulo de Or√ßamentos

**Data:** 16/01/2025  
**Objetivo:** Implementar m√≥dulo de gest√£o do funil de vendas atrav√©s de or√ßamentos odontol√≥gicos.

#### üéØ Funcionalidades Implementadas:

1. **P√°gina de Or√ßamentos**
   - Arquivo: `src/pages/OrcamentosPage.tsx`
   - Dashboard com KPIs: Total de or√ßamentos, valor total, aprovados, taxa de convers√£o
   - Tabela com lista de or√ßamentos e status visual (aguardando, aprovado, rejeitado, em negocia√ß√£o)
   - Barra de probabilidade de convers√£o para cada or√ßamento
   - Controles de busca e filtros

2. **Integra√ß√£o na Sidebar**
   - Arquivo: `src/components/Sidebar.tsx`
   - Adicionado "Or√ßamentos" na se√ß√£o **üë©‚Äç‚öïÔ∏è Atendimento**
   - √çcone: FileText (lucide-react)
   - Rota: `/orcamentos`

3. **Roteamento**
   - Arquivo: `src/App.tsx`
   - Nova rota configurada para OrcamentosPage
   - Integra√ß√£o com React Router

4. **Funcionalidades da Interface:**
   - **KPIs visuais:** Cards com m√©tricas de performance do funil
   - **Status coloridos:** Indicadores visuais para cada status de or√ßamento
   - **A√ß√µes r√°pidas:** Bot√µes para editar, aprovar e rejeitar or√ßamentos
   - **Busca e filtros:** Ferramentas para gest√£o eficiente da lista
   - **Dados mockados:** Exemplos realistas de or√ßamentos odontol√≥gicos

### ‚úÖ Reorganiza√ß√£o da Sidebar por Jornadas de Trabalho

**Data:** 16/01/2025  
**Objetivo:** Separar ferramentas de atendimento das de gest√£o/backoffice para melhor organiza√ß√£o do fluxo de trabalho.

#### üéØ Funcionalidades Implementadas:

1. **Nova Estrutura da Sidebar**
   - Arquivo: `src/components/Sidebar.tsx`
   - Separa√ß√£o em duas se√ß√µes distintas: **Atendimento** e **Gest√£o**
   - Mantido apenas o bot√£o "Iniciar Nova Consulta" (sem adicionar Modo Consulta)
   - Renomea√ß√£o: "Comunica√ß√£o" ‚Üí "CRM"

2. **Novo M√≥dulo Cont√°bil**
   - Arquivo: `src/pages/ContabilPage.tsx`
   - Dashboard com DAS, documentos pendentes e calend√°rio de obriga√ß√µes
   - Integra√ß√£o com roteamento em `App.tsx`

3. **Organiza√ß√£o por Contexto de Uso:**
   - **üë©‚Äç‚öïÔ∏è Atendimento:** In√≠cio, Agenda, Pacientes, Or√ßamentos
   - **‚öôÔ∏è Gest√£o:** Financeiro, Estoque, CRM, Relat√≥rios, Cont√°bil

### ‚úÖ Implementa√ß√£o de Sugest√µes Contextuais por M√≥dulo

**Data:** 16/01/2025  
**Objetivo:** Implementar sugest√µes de queries contextuais espec√≠ficas para cada m√≥dulo, seguindo as diretrizes do PRD.

#### üéØ Funcionalidades Implementadas:

1. **Sistema Centralizado de Sugest√µes**
   - Arquivo: `src/data/contextualSuggestions.ts`
   - Sugest√µes espec√≠ficas para cada m√≥dulo/p√°gina
   - Prioriza√ß√£o autom√°tica (alta, m√©dia, baixa)
   - Categoriza√ß√£o por tipo (a√ß√£o, pergunta, an√°lise)

2. **ChatOverlay Aprimorado**
   - Arquivo: `src/components/ChatOverlay.tsx`
   - Exibi√ß√£o de sugest√µes contextuais acima da barra de chat
   - √çcones e cores diferenciadas por categoria
   - Integra√ß√£o com sistema de prioridades

3. **P√°ginas Completas Implementadas:**
   - `PacientesPage.tsx` - Gest√£o de pacientes com dados mockados
   - `FinanceiroPage.tsx` - Dashboard financeiro com m√©tricas
   - `EstoquePage.tsx` - Controle de estoque com alertas
   - `ComunicacaoPage.tsx` - CRM e automa√ß√£o de mensagens
   - `RelatoriosPage.tsx` - An√°lises e insights

### ‚úÖ Implementa√ß√£o de Anima√ß√µes Leves para Novas Mensagens

**Data:** 16/01/2025  
**Objetivo:** Adicionar feedback visual suave para novas mensagens no chat, melhorando a experi√™ncia do usu√°rio com anima√ß√µes leves.

#### üéØ Funcionalidades Implementadas:

1. **Anima√ß√£o Fade-in + Slide-up**
   - Arquivos: `src/components/ChatOverlay.tsx`, `src/components/AIChatPanel.tsx`, `src/index.css`
   - Anima√ß√£o sutil de 0.4s com easing suave (`ease-out`)
   - Movimento vertical de 12px para cima com fade-in simult√¢neo
   - Aplicada tanto para mensagens do usu√°rio quanto do assistente

2. **Sistema de Controle de Anima√ß√£o**
   - Estado `newMessageIds` para rastrear mensagens rec√©m-criadas
   - `useEffect` com timer de 600ms para remover classes de anima√ß√£o
   - Propriedade `isNew` adicionada ao tipo `Message`
   - Anima√ß√£o ativada apenas para mensagens novas

3. **Implementa√ß√£o CSS Customizada**
   - Keyframes `fade-slide-up` com transforma√ß√µes suaves
   - Classe utilit√°ria `.animate-fade-slide-up` para aplica√ß√£o
   - Integra√ß√£o com Tailwind CSS mantendo performance

4. **Experi√™ncia do Usu√°rio:**
   - **Feedback imediato:** Usu√°rio v√™ sua mensagem aparecer suavemente
   - **Resposta da IA:** Anima√ß√£o indica quando nova resposta chega
   - **N√£o-intrusivo:** Anima√ß√£o leve que n√£o distrai da leitura
   - **Consist√™ncia:** Mesmo comportamento em ambos os modos de chat (overlay e panel)

#### üé® Detalhes T√©cnicos da Anima√ß√£o:

```css
@keyframes fade-slide-up {
  0% {
    opacity: 0;
    transform: translateY(12px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-slide-up {
  animation: fade-slide-up 0.4s ease-out;
}
```

#### üîÑ Fluxo da Anima√ß√£o:

```
Usu√°rio envia mensagem
    ‚Üì
Mensagem criada com isNew: true
    ‚Üì
newMessageIds atualizado com ID da mensagem
    ‚Üì
Classe 'animate-fade-slide-up' aplicada
    ‚Üì
Anima√ß√£o executa por 400ms
    ‚Üì
Ap√≥s 600ms, useEffect limpa newMessageIds
    ‚Üì
Classe de anima√ß√£o removida
```

### ‚úÖ Sistema de Chat Conversacional na HomePage

**Data:** 16/01/2025  
**Objetivo:** Implementar sistema de conversa√ß√£o com overlay flutuante e blur na p√°gina inicial, mantendo conte√∫do fixo e experi√™ncia similar ao ChatOverlay.

#### üéØ Funcionalidades Implementadas:

1. **Sistema de Conversa√ß√£o com Overlay**
   - Arquivo: `src/pages/HomePage.tsx`
   - Estados de chat: `suggestions` (padr√£o) e `conversation`
   - Overlay flutuante com backdrop blur quando em conversa√ß√£o
   - Conte√∫do da p√°gina permanece fixo (n√£o √© empurrado para baixo)

### ‚úÖ Contagem de Tempo Din√¢mica nos Cards de Status

**Data:** 16/01/2025  
**Objetivo:** Implementar contagem de tempo real nos cards de pacientes para melhorar o acompanhamento do fluxo de atendimento.

#### üéØ Funcionalidades Implementadas:

1. **Tempo Din√¢mico para Check-in Realizado**
   - Arquivo: `src/pages/HomePage.tsx`
   - Para pacientes na cl√≠nica com check-in realizado: mostra tempo decorrido desde a chegada
   - Fun√ß√£o `calcularTempoDesdeCheckIn()` calcula minutos desde o check-in
   - Formato: "15 min na cl√≠nica", "1 min na cl√≠nica", "chegou agora"

2. **Tempo Din√¢mico para Consultas em Andamento**
   - Para consultas no consult√≥rio: mostra tempo decorrido desde in√≠cio da consulta
   - Fun√ß√£o `calcularTempoDesdeInicioConsulta()` calcula minutos desde o in√≠cio
   - Formato: "45 min em andamento", "1 min em andamento", "iniciando"

3. **Sistema de Atualiza√ß√£o Autom√°tica**
   - `useEffect` com intervalo de 30 segundos para atualiza√ß√£o dos tempos
   - Estados tipados com interfaces `PacienteNaClinica` e `ConsultaNoConsultorio`
   - Propriedades adicionadas: `checkInTime` e `consultaIniciada` (Date | null)

4. **Integra√ß√£o com Check-in**
   - Fun√ß√£o `handleCheckIn()` atualizada para registrar timestamp do check-in
   - Timestamp autom√°tico quando paciente faz check-in
   - Transi√ß√£o autom√°tica de tempo est√°tico para din√¢mico

#### üîÑ Fluxo do Sistema:

```
Paciente na cl√≠nica (sem check-in)
    ‚Üì
Exibe tempo est√°tico (ex: "5 min")
    ‚Üì
Usu√°rio clica "Check-in"
    ‚Üì
checkInTime = new Date()
    ‚Üì
Exibe tempo din√¢mico: calcularTempoDesdeCheckIn()
    ‚Üì
Atualiza√ß√£o autom√°tica a cada 30s
```

#### üìä Benef√≠cios Implementados:

- **Monitoramento real:** Acompanhamento preciso do tempo de espera
- **Gest√£o de fluxo:** Identifica√ß√£o de gargalos no atendimento
- **Experi√™ncia do paciente:** Controle visual do tempo de perman√™ncia
- **Automa√ß√£o:** Sem necessidade de input manual de tempos

2. **Anima√ß√µes de Mensagens**
   - Mesma anima√ß√£o `fade-slide-up` dos outros componentes
   - Controle de anima√ß√£o com `newMessageIds` e `useEffect`
   - Anima√ß√£o aplicada tanto para mensagens do usu√°rio quanto da IA
   - Dura√ß√£o de 400ms with cleanup autom√°tico ap√≥s 600ms

3. **Interface com Overlay e Blur**
   - **Modo Sugest√µes:** Pills de a√ß√µes e perguntas (estado padr√£o)
   - **Modo Conversa:** Overlay flutuante centralizado na tela
   - **Backdrop:** Escuro com blur (`bg-black bg-opacity-20 backdrop-blur-sm`)
   - **Mensagens:** Semi-transparentes com blur (`bg-white/95 backdrop-blur-sm`)

4. **Compatibilidade com Modais Generativos**
   - Detec√ß√£o de palavras-chave (`agendar`, `cadastrar paciente`)
   - Prioridade para modais generativos sobre sistema de chat
   - Mant√©m funcionalidade existente intacta

5. **Experi√™ncia do Usu√°rio:**
   - **Overlay centralizado:** 600px de largura, 70vh de altura m√°xima
   - **Header flutuante:** T√≠tulo da conversa + bot√£o fechar
   - **Mensagens do usu√°rio:** Estilo indigo semi-transparente, alinhadas √† direita
   - **Mensagens da IA:** Estilo branco semi-transparente, alinhadas √† esquerda
   - **Action cards:** Bot√µes clic√°veis em mensagens da IA
   - **Click-to-close:** Clique no backdrop para fechar conversa

#### üé® Layout do Overlay com Backdrop:

```
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚Üê Backdrop escuro + blur
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îÇ Mensagem user   ‚îÇ‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îÇ Resposta da IA          ‚îÇ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îÇ [üìä Action] [üë• Card]   ‚îÇ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
```

#### üîÑ Fluxo de Intera√ß√£o na HomePage:

```
Estado inicial: Modo 'suggestions' com pills vis√≠veis
    ‚Üì
Usu√°rio digita mensagem
    ‚Üì
Se mensagem = "agendar*" ‚Üí Modal Generativo de Agendamento
Se mensagem = "cadastrar paciente*" ‚Üí Modal Generativo de Paciente
Sen√£o ‚Üí Overlay de Chat Conversacional
    ‚Üì
Backdrop blur aparece + overlay centralizado
    ‚Üì
Mensagem do usu√°rio aparece com anima√ß√£o
    ‚Üì
Ap√≥s 1s: Resposta da IA com action cards
    ‚Üì
Usu√°rio pode: continuar conversa, clicar backdrop ou [X] para fechar
    ‚Üì
Overlay desaparece + volta ao modo 'suggestions'
```

---

## üèóÔ∏è Estrutura da Sidebar

### Organiza√ß√£o por Jornadas de Trabalho

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CAPIM                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [ü©∫ Iniciar Nova Consulta]          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üë©‚Äç‚öïÔ∏è ATENDIMENTO                     ‚îÇ
‚îÇ ‚Ä¢ In√≠cio                            ‚îÇ
‚îÇ ‚Ä¢ Agenda                            ‚îÇ
‚îÇ ‚Ä¢ Pacientes                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚öôÔ∏è GEST√ÉO                           ‚îÇ
‚îÇ ‚Ä¢ Financeiro                        ‚îÇ
‚îÇ ‚Ä¢ Estoque                           ‚îÇ
‚îÇ ‚Ä¢ CRM                               ‚îÇ
‚îÇ ‚Ä¢ Relat√≥rios                        ‚îÇ
‚îÇ ‚Ä¢ Cont√°bil                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Benef√≠cios da Nova Organiza√ß√£o:

- **Clareza no Fluxo:** Separa√ß√£o entre atividades cl√≠nicas e administrativas
- **Redu√ß√£o da Sobrecarga Cognitiva:** Agrupamento l√≥gico por contexto de uso
- **Prepara√ß√£o para IA:** Estrutura alinhada com os agentes definidos no MVP
- **Efici√™ncia Operacional:** Acesso r√°pido √†s ferramentas mais usadas em cada contexto

---

## üó∫Ô∏è Fluxos Principais

### 1. Fluxo de Chat com Overlay Bubble

```
Estado inicial: Pills de sugest√£o vis√≠veis
    ‚Üì
Usu√°rio digita mensagem ou clica em sugest√£o
    ‚Üì
Usu√°rio pressiona Enter ou clica em Send
    ‚Üì
Pills desaparecem + Overlay bubble aparece (fixed position)
    ‚Üì
IA responde ap√≥s 1s delay + Action cards aparecem
    ‚Üì
Usu√°rio pode: continuar conversa, clicar actions, ou fechar
    ‚Üì
Fechar: click backdrop/X/Limpar ‚Üí volta ao estado inicial
```

### 2. Fluxo de Sugest√µes Contextuais

```
Usu√°rio navega para um m√≥dulo
    ‚Üì
ChatOverlay detecta rota atual via useLocation
    ‚Üì
getPrioritizedSuggestions() busca sugest√µes espec√≠ficas
    ‚Üì
Exibe at√© 3 sugest√µes priorizadas acima da barra de chat
    ‚Üì
Usu√°rio clica em sugest√£o ‚Üí preenche campo de texto automaticamente
```

### 3. Mapeamento de Sugest√µes por M√≥dulo

| M√≥dulo | Qtd. Sugest√µes | Exemplos Principais |
|--------|---------------|-------------------|
| **Agenda** | 5 | "Remarque a consulta de Maria para pr√≥xima semana" |
| **Pacientes** | 5 | "Quem n√£o voltou desde abril?" |
| **Financeiro** | 5 | "Conciliar transa√ß√µes banc√°rias do dia" |
| **Estoque** | 5 | "Repor anest√©sicos - estoque baixo" |
| **CRM** | 5 | "Enviar WhatsApp para confirmar consultas de amanh√£" |
| **Relat√≥rios** | 5 | "Explicar por que o faturamento caiu 15% este m√™s" |
| **Cont√°bil** | 5 | "Gerar DAS de dezembro e lembrar vencimento" |

### 4. Sistema de Prioriza√ß√£o

```typescript
priority: 'alta' | 'media' | 'baixa'
category: 'acao' | 'pergunta' | 'analise'
```

- **Prioridade Alta**: Exibida primeiro, a√ß√µes cr√≠ticas do dia
- **Prioridade M√©dia**: Tarefas importantes mas n√£o urgentes  
- **Prioridade Baixa**: A√ß√µes de otimiza√ß√£o e melhoria

---

## üé® UI/UX Patterns

### C√≥digo Visual das Categorias:

- **üü¢ A√ß√µes** (`bg-green-100 text-green-700`) + √≠cone Zap
- **üîµ Perguntas** (`bg-blue-100 text-blue-700`) + √≠cone MessageCircle  
- **üü£ An√°lises** (`bg-purple-100 text-purple-700`) + √≠cone BarChart3

### Layout do ChatOverlay (Estado Inicial):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Sugest√µes para [M√≥dulo]:                            ‚îÇ
‚îÇ [üü¢ A√ß√£o 1] [üîµ Pergunta 1] [üü£ An√°lise 1]          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Contexto: [M√≥dulo] ‚îÇ [Input Field] ‚îÇ [Send Button]  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Layout do Overlay com Backdrop (Estado Conversa):

```
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚Üê Backdrop escuro + blur
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îÇ Mensagem user   ‚îÇ‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îÇ Resposta da IA          ‚îÇ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îÇ [üìä Action] [üë• Card]   ‚îÇ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
```

#### üîß Detalhes T√©cnicos:

- **Z-index hierarchy:** Input/buttons (z-50) > Overlay messages (z-40) > Backdrop (z-40)
- **Positioning:** Container ajustado para √°rea sem sidebar (`left-64 right-0`)
- **Centraliza√ß√£o:** Flex justify-center no container principal
- **Padding:** `pt-8` no container para espa√ßamento superior
- **Responsividade:** Max-height 70vh com scroll autom√°tico
- **Click-to-close:** Apenas clique no backdrop (sem bot√£o X)

---

## üîß Arquitetura T√©cnica

### Componentes Modificados:

1. **`ChatOverlay.tsx`**
   - Adicionado import de sugest√µes contextuais
   - Implementado sistema de prioriza√ß√£o visual
   - Integra√ß√£o com useLocation para detec√ß√£o de contexto

2. **`contextualSuggestions.ts`**
   - Sistema centralizado de sugest√µes
   - Fun√ß√µes utilit√°rias para busca e prioriza√ß√£o
   - Mapeamento completo por rota

3. **P√°ginas Implementadas:**
   - Todas as p√°ginas agora t√™m dados mockados realistas
   - UI consistente com cards de m√©tricas
   - Integra√ß√£o com ChatOverlay

### Dependency Tree:

```
App.tsx
‚îú‚îÄ‚îÄ Layout.tsx
‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.tsx
‚îÇ   ‚îú‚îÄ‚îÄ [PageComponents]
‚îÇ   ‚îî‚îÄ‚îÄ ChatOverlay.tsx
‚îÇ       ‚îî‚îÄ‚îÄ contextualSuggestions.ts
‚îî‚îÄ‚îÄ pages/
    ‚îú‚îÄ‚îÄ HomePage.tsx
    ‚îú‚îÄ‚îÄ AgendaPage.tsx (j√° existente)
    ‚îú‚îÄ‚îÄ PacientesPage.tsx (novo)
    ‚îú‚îÄ‚îÄ FinanceiroPage.tsx (novo)
    ‚îú‚îÄ‚îÄ EstoquePage.tsx (novo)
    ‚îú‚îÄ‚îÄ ComunicacaoPage.tsx (novo)
    ‚îî‚îÄ‚îÄ RelatoriosPage.tsx (novo)
```

---

## üöÄ Como Testar

1. **Executar o projeto:**
   ```bash
   cd projetos/saas_agentico/capim-ai-demo
   npm run dev
   ```

2. **Testar sugest√µes contextuais:**
   - Navegar para cada m√≥dulo (Agenda, Pacientes, Financeiro, etc.)
   - Verificar se as sugest√µes espec√≠ficas aparecem no ChatOverlay
   - Clicar nas sugest√µes para preencher o campo de texto

3. **Verificar prioriza√ß√£o:**
   - Sugest√µes de alta prioridade devem aparecer primeiro
   - Cores e √≠cones devem estar corretos por categoria

---

## üìù Pr√≥ximas Melhorias Sugeridas

1. **Sugest√µes Din√¢micas:** Basear sugest√µes no contexto atual da tela (ex: se h√° paciente selecionado)
2. **Hist√≥rico de Sugest√µes:** Lembran√ßa das sugest√µes mais utilizadas por usu√°rio
3. **A/B Testing:** Testar diferentes formatos de sugest√µes
4. **Integra√ß√£o com IA:** Gerar sugest√µes baseadas em padr√µes de uso

---

## üêõ Issues Conhecidos

- ‚úÖ Erro de import do tipo `ContextualSuggestion` - **Resolvido** com type-only import
- ‚úÖ Conflito entre placeholders e componentes reais - **Resolvido** removendo placeholders
- ‚ö†Ô∏è Sugest√µes ainda n√£o s√£o funcionais (apenas preenchem o campo de texto)

---

## üìä M√©tricas de Implementa√ß√£o

- **Linhas de c√≥digo adicionadas:** ~800 linhas
- **Novos arquivos criados:** 6 (5 p√°ginas + 1 arquivo de dados)
- **Componentes modificados:** 2 (ChatOverlay + App)
- **Tempo de implementa√ß√£o:** ~2 horas
- **Cobertura de m√≥dulos:** 100% (todos os 6 m√≥dulos implementados)

---

*Documento atualizado automaticamente ap√≥s cada mudan√ßa significativa no sistema.* 